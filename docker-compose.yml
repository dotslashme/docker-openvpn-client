version: '3.3'

services:
  openvpn-client:
    cap_add:
      - net_admin
    container_name: openvpn-client
    devices:
      - /dev/net/tun:/dev/net/tun
    dns:
      - 146.185.134.104
      - 192.241.172.159
    image: dotslashme/openvpn-client
    secrets:
      - vpn_user
      - vpn_password
    volumes:
      - type: bind
        source: ./config.ovpn
        target: /config.ovpn
  test:
    image: alpine:latest
    network_mode: service:openvpn-client
    command: /bin/sh -c "wget http://icanhazip.com/ && cat index.html && rm -f index.html"
    restart: unless-stopped

secrets:
  vpn_user:
    file: ./vpn_user
  vpn_password:
    file: ./vpn_password